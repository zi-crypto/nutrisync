<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
    <title>NutriSync - AI Coach</title>
    <!-- VAPID Key from Backend -->
    <meta name="vapid-key" content="{{ vapid_public_key }}">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="manifest" href="/static/manifest.json">
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Cairo:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- i18n engine (must load before other scripts) -->
    <script src="/static/i18n.js"></script>
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="/static/workout_coach.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="/static/style.css">

    <!-- PostHog Analytics (key injected server-side via Jinja2) -->
    {% if posthog_api_key %}
    <script>
        !function (t, e) { var o, n, p, r; e.__SV || (window.posthog = e, e._i = [], e.init = function (i, s, a) { function g(t, e) { var o = e.split("."); 2 == o.length && (t = t[o[0]], e = o[1]), t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } } (p = t.createElement("script")).type = "text/javascript", p.crossOrigin = "anonymous", p.async = !0, p.src = s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") + "/static/array.js", (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r); var u = e; for (void 0 !== a ? u = e[a] = [] : a = "posthog", u.people = u.people || [], u.toString = function (t) { var e = "posthog"; return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e }, u.people.toString = function () { return u.toString(1) + ".people (stub)" }, o = "init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "), n = 0; n < o.length; n++)g(u, o[n]); e._i.push([i, s, a]) }, e.__SV = 1) }(document, window.posthog || []);

        posthog.init('{{ posthog_api_key }}', {
            api_host: '/ingest',
            ui_host: 'https://eu.posthog.com',
            person_profiles: 'identified_only',
            capture_pageview: true,
            capture_pageleave: true,
            autocapture: true,
            disable_session_recording: true,
            loaded: function (posthog) {
                if (window.location.hostname === 'localhost') {
                    posthog.debug();
                }
            }
        });
    </script>
    {% endif %}
</head>

<body>
    <div class="chat-container">
        <header>
            <div class="logo" data-i18n="header.logo">NutriSync</div>
            <div class="status" data-i18n="header.status">Online</div>
            <div class="header-right" style="display: flex; align-items: center; gap: 15px;">
                <!-- Language Switcher -->
                <select id="lang-switcher" class="lang-switcher" title="Language">
                    <option value="en">EN</option>
                    <option value="ar">Ø¹Ø±</option>
                </select>
                <button id="workout-tracker-toggle-btn" class="icon-btn hidden"
                    data-i18n-title="header.title.workout_tracker" title="Workout Tracker">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 20V10"></path>
                        <path d="M12 20V4"></path>
                        <path d="M6 20v-6"></path>
                    </svg>
                </button>
                <button id="live-coach-toggle-btn" class="icon-btn hidden" data-i18n-title="header.title.live_coach"
                    title="Live Coach">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 7l-7 5 7 5V7z"></path>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                </button>
                <div id="profile-section" class="profile-section hidden"
                    style="display: flex; align-items: center; gap: 10px;">
                    <span id="header-username" style="font-weight: 500;">User</span>
                    <button id="settings-btn" class="icon-btn" data-i18n-title="header.title.edit_profile"
                        title="Edit Profile">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <div id="chat-history" class="chat-history">
            <!-- Messages will appear here -->
            <div class="message bot-message" data-i18n="chat.welcome">
                Hello! I'm your NutriSync coach. How can I help you today?
            </div>
        </div>

        <div class="input-area">
            <div id="image-preview-container" class="image-preview-container" style="display: none;">
                <img id="image-preview" src="" alt="Preview">
                <button id="clear-image" class="clear-image-btn">&times;</button>
            </div>

            <input type="file" id="file-input" accept="image/*" style="display: none;">
            <button id="upload-btn" data-i18n-title="header.title.upload_image" title="Upload Image">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48">
                    </path>
                </svg>
            </button>

            <textarea id="user-input" data-i18n-placeholder="chat.placeholder" placeholder="Type your message..."
                rows="1"></textarea>
            <button id="send-btn" data-i18n-title="header.title.send" title="Send">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <!-- Auth Overlay -->
    <div id="auth-overlay" class="auth-overlay">
        <div class="auth-box">
            <h2 id="auth-title" data-i18n="auth.title.signin">Welcome to NutriSync</h2>
            <p id="auth-subtitle" data-i18n="auth.subtitle.signin">Sign in to continue</p>

            <form id="auth-form">
                <div class="form-group">
                    <label for="email" data-i18n="auth.label.email">Email</label>
                    <input type="email" id="email" data-i18n-placeholder="auth.placeholder.email"
                        placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password" data-i18n="auth.label.password">Password</label>
                    <input type="password" id="password" data-i18n-placeholder="auth.placeholder.password"
                        placeholder="Enter your password" required>
                </div>
                <button type="submit" id="auth-submit-btn" data-i18n="auth.btn.signin">Sign In</button>
            </form>

            <div class="auth-footer">
                <span id="auth-toggle-text" data-i18n="auth.toggle.no_account">Don't have an account?</span>
                <button id="auth-toggle-btn" data-i18n="auth.btn.signup">Sign Up</button>
            </div>
            <div id="auth-message" class="auth-message"></div>
        </div>
    </div>

    <!-- Live Coach Overlay -->
    <div id="live-coach-overlay" class="auth-overlay hidden">
        <div class="auth-box wizard-box" style="width: 95%; max-width: 700px; padding: 20px;">
            <button id="close-coach-btn" class="icon-btn"
                style="position: absolute; top: 15px; inset-inline-end: 15px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2 id="coach-title" data-i18n="coach.title">NutriSync Live Coach</h2>
            <p id="coach-subtitle" data-i18n="coach.subtitle">Ensure your full body is visible in the camera.</p>

            <div style="text-align: center; margin-bottom: 10px;">
                <label for="coach-exercise-select" style="margin-inline-end: 10px; color: #E2E8F0;"
                    data-i18n="coach.label.exercise">Exercise:</label>
                <select id="coach-exercise-select"
                    style="padding: 6px 12px; border-radius: 6px; background-color: #2D3748; color: white; border: 1px solid #4A5568;">
                    <option value="squat" data-i18n="coach.exercise.squat">Squats</option>
                    <option value="pushup" data-i18n="coach.exercise.pushup">Pushups</option>
                    <option value="pullup" data-i18n="coach.exercise.pullup">Pullups / Lat Pulldown</option>
                </select>
            </div>

            <div class="coach-video-container"
                style="position: relative; width: 100%; max-width: 640px; margin: 15px auto; border-radius: 8px; overflow: hidden; background: #000;">
                <video id="coach-video" class="input_video" autoplay muted playsinline style="display: none;"></video>
                <canvas id="coach-canvas" class="output_canvas" width="640" height="480"
                    style="width: 100%; display: block;"></canvas>
            </div>

            <!-- Session Stats -->
            <div id="coach-session-stats" class="coach-session-stats hidden">
                <span id="coach-session-sets">Sets logged: 0</span>
                <span id="coach-session-reps-display"></span>
            </div>

            <div class="wizard-footer" style="justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                <button type="button" id="start-coach-btn" data-i18n="coach.btn.start">Start Tracking</button>
                <button type="button" id="stop-coach-btn" class="secondary-btn hidden"
                    data-i18n="coach.btn.stop">Stop</button>
                <button type="button" id="log-exercise-btn" class="coach-log-btn hidden" disabled>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round"
                        style="vertical-align: middle; margin-inline-end: 6px;">
                        <path d="M9 11l3 3L22 4"></path>
                        <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                    </svg>
                    <span id="log-exercise-btn-text" data-i18n="coach.btn.log">Log Exercise</span>
                </button>
            </div>

            <!-- Toast Notification -->
            <div id="coach-toast" class="coach-toast hidden"></div>
        </div>
    </div>

    <!-- Workout Tracker Overlay -->
    <div id="workout-tracker-overlay" class="auth-overlay hidden">
        <div class="auth-box wizard-box wt-overlay-box">
            <button id="close-tracker-btn" class="icon-btn wt-close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <!-- Tab Bar -->
            <div class="wt-tab-bar">
                <button class="wt-tab active" data-tab="plan" data-i18n="tracker.tab.plan">ðŸ“‹ Plan</button>
                <button class="wt-tab" data-tab="progress" data-i18n="tracker.tab.progress">ðŸ“ˆ Progress</button>
                <button class="wt-tab" data-tab="volume" data-i18n="tracker.tab.volume">ðŸ”¥ Volume</button>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 1: PLAN VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="wt-tab-content active" id="wt-plan-tab">
                <div class="wt-plan-header">
                    <h2 class="wt-section-title" data-i18n="tracker.plan.title">ðŸ“‹ My Workout Plan</h2>
                    <button id="wt-regenerate-btn" class="secondary-btn wt-regen-btn"
                        data-i18n="tracker.plan.regenerate" data-i18n-title="tracker.plan.regenerate_title"
                        title="Ask AI to regenerate plan">ðŸ”„ Regenerate Plan</button>
                </div>

                <!-- Split Day Tabs -->
                <div id="wt-day-tabs" class="wt-day-tabs">
                    <!-- Dynamically populated -->
                </div>

                <!-- Exercise List -->
                <div id="wt-exercise-list" class="wt-exercise-list">
                    <div class="wt-empty-state">
                        <p data-i18n="tracker.plan.empty">No workout plan yet.</p>
                        <p style="color:#8b949e;font-size:0.85rem;" data-i18n="tracker.plan.empty_hint">Ask the AI coach
                            to generate a plan for you, or click Regenerate Plan.</p>
                    </div>
                </div>

                <!-- Volume Summary -->
                <div id="wt-volume-summary" class="wt-volume-summary" style="display:none;"></div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 2: PROGRESS VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="wt-tab-content" id="wt-progress-tab">
                <div class="wt-progress-header">
                    <h2 class="wt-section-title" data-i18n="tracker.progress.title">ðŸ“ˆ Progressive Overload Tracker</h2>
                    <select id="wt-progress-weeks" class="form-select wt-small-select">
                        <option value="4" data-i18n="tracker.progress.weeks_4">4 weeks</option>
                        <option value="8" selected data-i18n="tracker.progress.weeks_8">8 weeks</option>
                        <option value="12" data-i18n="tracker.progress.weeks_12">12 weeks</option>
                        <option value="24" data-i18n="tracker.progress.weeks_24">24 weeks</option>
                    </select>
                </div>

                <div class="wt-exercise-filter">
                    <label data-i18n="tracker.progress.label_exercise">Exercise:</label>
                    <select id="wt-exercise-select" class="form-select wt-exercise-dropdown">
                        <option value="" data-i18n="tracker.progress.all_exercises">All Exercises</option>
                    </select>
                </div>

                <!-- Single Exercise View -->
                <div id="wt-single-exercise-view" style="display:none;">
                    <div class="wt-chart-card">
                        <h3 class="wt-chart-title" data-i18n="tracker.progress.e1rm_title">Estimated 1RM Trend</h3>
                        <canvas id="wt-e1rm-chart" height="200"></canvas>
                    </div>
                    <div class="wt-chart-card">
                        <h3 class="wt-chart-title" data-i18n="tracker.progress.volume_title">Volume Load Trend</h3>
                        <canvas id="wt-volume-chart" height="200"></canvas>
                    </div>
                    <div id="wt-session-history" class="wt-session-history"></div>
                    <div id="wt-pr-records" class="wt-pr-records"></div>
                </div>

                <!-- All Exercises View -->
                <div id="wt-all-exercises-view">
                    <div id="wt-all-exercises-list" class="wt-all-exercises-list">
                        <div class="wt-empty-state">
                            <p data-i18n="tracker.progress.empty">No exercise data yet.</p>
                            <p style="color:#8b949e;font-size:0.85rem;" data-i18n="tracker.progress.empty_hint">Start
                                logging sets via the AI coach to see your progress.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB 3: VOLUME HEATMAP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="wt-tab-content" id="wt-volume-tab">
                <div class="wt-volume-header">
                    <h2 class="wt-section-title" data-i18n="tracker.volume.title">ðŸ”¥ Weekly Muscle Volume</h2>
                    <div class="wt-week-nav">
                        <button id="wt-week-prev" class="wt-week-btn">â—€</button>
                        <span id="wt-week-label" data-i18n="tracker.volume.this_week">This Week</span>
                        <button id="wt-week-next" class="wt-week-btn">â–¶</button>
                    </div>
                </div>

                <div id="wt-muscle-bars" class="wt-muscle-bars">
                    <div class="wt-empty-state">
                        <p data-i18n="tracker.volume.empty">No volume data yet.</p>
                        <p style="color:#8b949e;font-size:0.85rem;" data-i18n="tracker.volume.empty_hint">Log exercise
                            sets to see your weekly muscle volume.</p>
                    </div>
                </div>

                <div class="wt-volume-legend">
                    <span class="wt-legend-item"><span class="wt-legend-swatch wt-legend-done"></span> <span
                            data-i18n="tracker.volume.legend_done">Done</span></span>
                    <span class="wt-legend-item"><span class="wt-legend-swatch wt-legend-remaining"></span> <span
                            data-i18n="tracker.volume.legend_remaining">Remaining</span></span>
                    <span class="wt-legend-info" data-i18n="tracker.volume.legend_info">Target based on experience level
                        + goal</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Onboarding Wizard -->
    <div id="onboarding-overlay" class="auth-overlay hidden">
        <div class="auth-box wizard-box">
            <h2 id="wizard-title" data-i18n="wizard.title.onboarding">Let's get to know you</h2>
            <p id="wizard-subtitle">Step 1 of 4</p>

            <form id="onboarding-form">
                <!-- Step 1: Basics -->
                <div class="wizard-step" data-step="1">
                    <div class="form-group">
                        <label for="profile-name" data-i18n="wizard.label.name">What should we call you?</label>
                        <input type="text" id="profile-name" data-i18n-placeholder="wizard.placeholder.name"
                            placeholder="Your Name" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-coach-name" data-i18n="wizard.label.coach_name">Name your Coach</label>
                        <input type="text" id="profile-coach-name" data-i18n-placeholder="wizard.placeholder.coach_name"
                            placeholder="NutriSync" maxlength="30">
                        <small style="color: rgba(255,255,255,0.5); font-size: 0.8rem;"
                            data-i18n="wizard.hint.coach_name">Give your AI coach a name â€” or keep the default.</small>
                    </div>
                </div>

                <!-- Step 2: Body Stats -->
                <div class="wizard-step hidden" data-step="2">
                    <div class="form-group">
                        <label for="profile-gender" data-i18n="wizard.label.gender">Gender</label>
                        <select id="profile-gender" class="form-select">
                            <option value="Male" data-i18n="wizard.option.gender.male">Male</option>
                            <option value="Female" data-i18n="wizard.option.gender.female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="profile-dob" data-i18n="wizard.label.dob">Date of Birth</label>
                        <input type="date" id="profile-dob" required>
                    </div>
                    <div class="form-group-row">
                        <div class="form-group">
                            <label for="profile-height" data-i18n="wizard.label.height">Height (cm)</label>
                            <input type="number" id="profile-height" data-i18n-placeholder="wizard.placeholder.height"
                                placeholder="175" required>
                        </div>
                        <div class="form-group">
                            <label for="profile-weight" data-i18n="wizard.label.weight">Weight (kg)</label>
                            <input type="number" id="profile-weight" data-i18n-placeholder="wizard.placeholder.weight"
                                placeholder="70" required>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Goals -->
                <div class="wizard-step hidden" data-step="3">
                    <div class="form-group">
                        <label for="profile-goal" data-i18n="wizard.label.goal">Fitness Goal</label>
                        <select id="profile-goal" class="form-select">
                            <option value="Lose Weight" data-i18n="wizard.option.goal.lose_weight">Lose Weight</option>
                            <option value="Build Muscle" data-i18n="wizard.option.goal.build_muscle">Build Muscle
                            </option>
                            <option value="Maintain" data-i18n="wizard.option.goal.maintain">Maintain</option>
                            <option value="Improve Endurance" data-i18n="wizard.option.goal.improve_endurance">Improve
                                Endurance</option>
                        </select>
                    </div>
                    <div class="form-group" id="target-weight-container">
                        <label for="profile-target-weight" data-i18n="wizard.label.target_weight">Target Weight
                            (kg)</label>
                        <input type="number" id="profile-target-weight"
                            data-i18n-placeholder="wizard.placeholder.target_weight" placeholder="70">
                    </div>
                    <div class="form-group">
                        <label for="profile-experience" data-i18n="wizard.label.experience">Experience Level</label>
                        <select id="profile-experience" class="form-select">
                            <option value="Beginner" data-i18n="wizard.option.experience.beginner">Beginner (0-1 years)
                            </option>
                            <option value="Intermediate" data-i18n="wizard.option.experience.intermediate">Intermediate
                                (1-3 years)</option>
                            <option value="Advanced" data-i18n="wizard.option.experience.advanced">Advanced (3+ years)
                            </option>
                        </select>
                    </div>
                </div>

                <!-- Step 4: Sport & Activity -->
                <div class="wizard-step hidden" data-step="4">
                    <div class="form-group">
                        <label for="profile-sport" data-i18n="wizard.label.sport">Main Activity / Sport</label>
                        <select id="profile-sport" class="form-select">
                            <option value="Gym" data-i18n="wizard.option.sport.gym">Gym / Bodybuilding</option>
                            <option value="Running" data-i18n="wizard.option.sport.running">Running</option>
                            <option value="Swimming" data-i18n="wizard.option.sport.swimming">Swimming</option>
                            <option value="Cycling" data-i18n="wizard.option.sport.cycling">Cycling</option>
                            <option value="Other" data-i18n="wizard.option.sport.other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="profile-days" data-i18n="wizard.label.days">Workout Days / Week</label>
                        <input type="number" id="profile-days" min="1" max="14" value="3">
                    </div>

                    <!-- Gym-Specific: Split Editor -->
                    <div id="gym-options">
                        <div class="form-group">
                            <label for="profile-split-template" data-i18n="wizard.label.split_template">Workout Split
                                Template</label>
                            <select id="profile-split-template" class="form-select">
                                <option value="PPL" data-i18n="wizard.option.split.ppl">Push / Pull / Legs</option>
                                <option value="Bro Split" data-i18n="wizard.option.split.bro">Bro Split (Body Parts)
                                </option>
                                <option value="Upper Lower" data-i18n="wizard.option.split.upper_lower">Upper / Lower
                                </option>
                                <option value="Full Body" data-i18n="wizard.option.split.full_body">Full Body</option>
                                <option value="Arnold Split" data-i18n="wizard.option.split.arnold">Arnold Split
                                </option>
                                <option value="PPL x2" data-i18n="wizard.option.split.ppl_x2">PPL x2 (6-Day)</option>
                                <option value="PPL + Rest (8-Day)" data-i18n="wizard.option.split.ppl_rest">PPL + Rest
                                    (8-Day)</option>
                                <option value="Custom" data-i18n="wizard.option.split.custom">Custom</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label data-i18n="wizard.label.schedule">Customize Your Schedule:</label>
                            <div id="split-editor-container"
                                style="display: grid; grid-template-rows: repeat(4, auto); grid-auto-flow: column; gap: 10px; margin-top: 8px;">
                                <!-- Dynamic Inputs will be injected here -->
                            </div>
                            <button type="button" id="add-split-day-btn" class="secondary-btn"
                                style="width: 100%; margin-top: 8px; font-size: 0.85rem; padding: 8px;"
                                data-i18n="wizard.btn.add_day">+ Add
                                Day</button>
                        </div>

                        <div class="form-group">
                            <label for="profile-equipment" data-i18n="wizard.label.equipment">Equipment Access</label>
                            <select id="profile-equipment" class="form-select">
                                <option value="Gym" data-i18n="wizard.option.equip.gym">Full Gym</option>
                                <option value="Home" data-i18n="wizard.option.equip.home">Home (Dumbbells/Bands)
                                </option>
                                <option value="Bodyweight" data-i18n="wizard.option.equip.bodyweight">Bodyweight Only
                                </option>
                            </select>
                        </div>

                        <div class="form-group" id="equipment-chips-section">
                            <label><span data-i18n="wizard.label.specific_equipment">Your Specific Equipment</span>
                                <span style="font-weight:400;color:rgba(255,255,255,0.5);font-size:0.85rem;"
                                    data-i18n="wizard.hint.specific_equipment">(select what you have)</span></label>
                            <div class="equip-select-all-row">
                                <button type="button" id="equip-select-all-btn" class="secondary-btn"
                                    style="font-size:0.8rem;padding:6px 14px;width:auto;"
                                    data-i18n="wizard.btn.select_all">âœ… Select All</button>
                                <button type="button" id="equip-deselect-all-btn" class="secondary-btn"
                                    style="font-size:0.8rem;padding:6px 14px;width:auto;"
                                    data-i18n="wizard.btn.clear_all">Clear All</button>
                            </div>
                            <div id="equipment-chips-container" class="equipment-chips-container">
                                <!-- Chips will be injected by JS -->
                            </div>
                            <div class="equip-custom-row" style="margin-top:10px;display:flex;gap:8px;">
                                <input type="text" id="equip-custom-input"
                                    data-i18n-placeholder="wizard.placeholder.custom_equipment"
                                    placeholder="Add custom equipment..." style="flex:1;">
                                <button type="button" id="equip-custom-add-btn" class="secondary-btn"
                                    style="padding:8px 14px;width:auto;font-size:0.85rem;"
                                    data-i18n="wizard.btn.add_custom">+ Add</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label data-i18n="wizard.label.1rm">1RM (1 Rep Max) Records (Optional)</label>
                            <p style="color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-top: 0; margin-bottom: 8px;"
                                data-i18n="wizard.hint.1rm">
                                Know your strength? Log it here. If not, choose a weight you can perform for 8 reps with
                                1â€“2 reps in reserve.
                            </p>
                            <div id="rm-editor-container" style="display: flex; flex-direction: column; gap: 10px;">
                                <!-- RM inputs will be injected here -->
                            </div>
                            <button type="button" id="add-rm-btn" class="secondary-btn"
                                style="width: 100%; margin-top: 8px; font-size: 0.85rem; padding: 8px;"
                                data-i18n="wizard.btn.add_1rm">+ Add 1RM
                                Record</button>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Nutrition -->
                <div class="wizard-step hidden" data-step="5">
                    <div class="form-group">
                        <label for="profile-diet-type" data-i18n="wizard.label.diet_type">Typical Diet Type</label>
                        <select id="profile-diet-type" class="form-select">
                            <option value="Balanced" data-i18n="wizard.option.diet.balanced">Balanced / Standard
                            </option>
                            <option value="Low Carb" data-i18n="wizard.option.diet.low_carb">Low Carb</option>
                            <option value="Keto" data-i18n="wizard.option.diet.keto">Keto</option>
                            <option value="High Protein" data-i18n="wizard.option.diet.high_protein">High Protein
                            </option>
                            <option value="Vegan" data-i18n="wizard.option.diet.vegan">Vegan</option>
                            <option value="Vegetarian" data-i18n="wizard.option.diet.vegetarian">Vegetarian</option>
                            <option value="Paleo" data-i18n="wizard.option.diet.paleo">Paleo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="profile-calories" data-i18n="wizard.label.calories">Typical Daily Calories
                            (Estimate)</label>
                        <input type="number" id="profile-calories" data-i18n-placeholder="wizard.placeholder.calories"
                            placeholder="e.g. 2000" required>
                        <small style="color: rgba(255,255,255,0.5); font-size: 0.8rem;"
                            data-i18n="wizard.hint.calories">We'll estimate this based on
                            your stats if unsure.</small>
                    </div>
                    <div class="form-group">
                        <label for="profile-allergies" data-i18n="wizard.label.allergies">Allergies /
                            Intolerances</label>
                        <input type="text" id="profile-allergies" data-i18n-placeholder="wizard.placeholder.allergies"
                            placeholder="e.g. Peanuts, Gluten, Dairy (Optional)">
                    </div>
                </div>

                <div class="wizard-footer">
                    <button type="button" id="wizard-cancel-btn" class="secondary-btn"
                        style="margin-inline-start:auto;color:rgba(255,255,255,0.5);"
                        data-i18n="wizard.btn.cancel">Cancel</button>
                    <button type="button" id="wizard-back-btn" class="secondary-btn hidden"
                        data-i18n="wizard.btn.back">Back</button>
                    <button type="button" id="wizard-next-btn" data-i18n="wizard.btn.next">Next</button>
                    <button type="submit" id="wizard-submit-btn" class="hidden"
                        data-i18n="wizard.btn.finish">Finish</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Push Notifications Overlay -->
    <div id="notifications-overlay" class="auth-overlay hidden">
        <div class="auth-box wizard-box" style="width: 380px; text-align: center; padding: 30px;">
            <div style="font-size: 3rem; margin-bottom: 15px;">ðŸ””</div>
            <h2 id="push-title" data-i18n="push.title" style="margin-bottom: 10px; font-size: 1.5rem; color: #fff;">Stay
                on Track</h2>
            <p id="push-subtitle" data-i18n="push.subtitle"
                style="color: #8b949e; margin-bottom: 24px; line-height: 1.5; font-size: 0.95rem;">Enable reminders to
                never miss a scheduled workout or meal log.</p>

            <div style="display: flex; flex-direction: column; gap: 12px;">
                <button type="button" id="push-enable-btn"
                    style="background: var(--user-msg-bg); color: white; width: 100%; padding: 12px; border-radius: 12px; font-weight: 600; border: none; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;"
                    data-i18n="push.enable">Enable Reminders</button>
                <button type="button" id="push-maybe-later-btn"
                    style="background: transparent; color: #8b949e; width: 100%; border: none; font-weight: 500; cursor: pointer; padding: 10px; transition: color 0.2s;"
                    data-i18n="push.later">Maybe Later</button>
            </div>
            <div id="push-message" class="auth-message"></div>
        </div>
    </div>

    <!-- Add Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script src="/static/script.js?v=2"></script>
</body>

</html>